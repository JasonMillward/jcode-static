!function(E,r){"use strict";var o,i,B,a,c="commento",m="commento-main-area",d="commento-login",T="commento-login-box-container",H="commento-login-box",C="commento-login-box-email-subtitle",N="commento-login-box-email-input",u="commento-login-box-password-input",p="commento-login-box-name-input",f="commento-login-box-website-input",S="commento-login-box-email-button",L="commento-login-box-forgot-link-container",A="commento-login-box-login-link-container",M="commento-login-box-sso-pretext",O="commento-login-box-sso-buttton-container",R="commento-login-box-hr1",I="commento-login-box-oauth-pretext",D="commento-login-box-oauth-buttons-container",U="commento-login-box-hr2",l="commento-mod-tools",t="commento-mod-tools-lock-button",s="commento-error",v="commento-logged-container",h="commento-comments-area",k="commento-textarea-super-container-",g="commento-notice-container",x="commento-textarea-container-",b="commento-textarea-",w="commento-anonymous-checkbox-",y="commento-guest-details-",P="commento-guest-details-input-",V="commento-sort-policy-",j="commento-comment-card-",q="commento-comment-body-",Y="commento-comment-text-",z="commento-comment-subtitle-",W="commento-comment-timeago-",_="commento-comment-score-",F="commento-comment-options-",X="commento-comment-edit-",G="commento-comment-reply-",J="commento-comment-collapse-",K="commento-comment-upvote-",$="commento-comment-downvote-",Q="commento-comment-approve-",Z="commento-comment-remove-",ee="commento-comment-sticky-",ne="commento-comment-children-",te="commento-comment-contents-",oe="commento-comment-name-",ie="commento-submit-button-",re="commento-markdown-button-",ae="commento-markdown-help-",n=!1,ce=window.document.title,me="https://commento-jcode.herokuapp.com",de="https://commento-jcode.herokuapp.com",le=null,se=parent.location.pathname,ue=!1,pe=!0,fe=[],ve=[],he={},ge={},xe={},be=!0,we=!1,ye=!1,ke=!1,Te="none",He={},Ce={},Ne={},Se={},Le=!1,Ae="login",Me=!1,Ee="score-desc",Be=void 0,Oe=null;function Re(e){return r.getElementById(e)}function Ie(e,n){e.appendChild(n)}function De(e,n){e.classList.add("commento-"+n)}function Ue(e,n){null!==e&&e.classList.remove("commento-"+n)}function Pe(e){return r.createElement(e)}function Ve(e){null!==e&&e.parentNode.removeChild(e)}function je(e,n){var t=e.attributes[n];if(void 0!==t)return t.value}function qe(e){if(null!==e){var n=e.cloneNode(!0);if(null!==e.parentNode)return e.parentNode.replaceChild(n,e),n}return e}function Ye(e,n,t){e.addEventListener("click",function(){n(t)},!1)}function ze(e,n,t){e.addEventListener("keypress",function(e){"Enter"===e.key&&n(t)},!1)}function We(e,n,t){e.setAttribute(n,t)}function _e(e,n,t){var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onload=function(){t(JSON.parse(o.response))},o.send(JSON.stringify(n))}function Fe(e){"function"==typeof e&&e()}function Xe(e,n){var t,o=new Date;o.setTime(o.getTime()+31536e6),t="; expires="+o.toUTCString(),r.cookie=e+"="+n+t+"; path=/"}function Ge(){var e=function(e){var n=("; "+r.cookie).split("; "+e+"=");if(2===n.length)return n.pop().split(";").shift()}("commentoCommenterToken");return void 0===e?"anonymous":e}function Je(){window.open(me+"/profile?commenterToken="+Ge(),"_blank")}function Ke(e){window.open(me+"/unsubscribe?unsubscribeSecretHex="+e,"_blank")}function $e(e,n){xe[e.commenterHex]=e,Be=e.commenterHex;var t,o,i=Pe("div"),r=Pe("div");"undefined"!==e.link?((t=Pe("a")).target="_blank",t.rel="nofollow noopener"):t=Pe("div");var a=Pe("div"),c=Pe("div"),m=Pe("div"),d=un(e.commenterHex+"-"+e.name);i.id=v,De(i,"logged-container"),De(r,"logged-in-as"),De(t,"name"),De(a,"profile-button"),De(c,"profile-button"),De(m,"profile-button"),t.innerText=e.name,a.innerText="Notification Settings",c.innerText="Settings",m.innerText="Logout",Ye(m,E.logout),Ye(a,Ke,n.unsubscribeSecretHex),Ye(c,Je),We(i,"style","display: none"),"undefined"!==e.link&&We(t,"href",e.link),"undefined"===e.photo?((o=Pe("div")).style.background=d,o.innerHTML=e.name[0].toUpperCase(),De(o,"avatar")):(We(o=Pe("img"),"src",de+"/api/commenter/photo?commenterHex="+e.commenterHex),We(o,"loading","lazy"),De(o,"avatar-img")),Ie(r,o),Ie(r,t),Ie(i,r),Ie(i,m),"commento"===e.provider&&Ie(i,c),function(e,n){e.prepend(n)}(le,i),ue=!0}function Qe(n){if("anonymous"===Ge())return ue=!1,void Fe(n);var e={commenterToken:Ge()};_e(me+"/api/commenter/self",e,function(e){if(!e.success)return Xe("commentoCommenterToken","anonymous"),void Fe(n);$e(e.commenter,e.email),Sn(),Fe(n)})}function Ze(e,n){var t=Pe("link"),o=r.getElementsByTagName("head")[0];t.type="text/css",We(t,"href",e),We(t,"rel","stylesheet"),function(e,n,t){e.addEventListener("load",function(){n(t)})}(t,n),Ie(o,t)}function en(r,a){var e={commenterToken:Ge(),domain:parent.location.host,path:se};_e(me+"/api/comment/list",e,function(e){if(!a){if(!e.success)return void nn(e.message);tn(),Ee=e.defaultSortPolicy}be=e.requireIdentification,we=e.isModerator,ye=e.isFrozen,ke=e.attributes.isLocked,Te=e.attributes.stickyCommentHex;var n=[];for(var t in fe)n.push(fe[t].commentHex);if(fe=e.comments,!pe)for(var o in fe)-1===n.indexOf(fe[o].commentHex)&&(he[fe[o].commentHex]=!0);for(t=ve.length;t--;)for(var o in fe)if(fe[o].commentHex===ve[t].commentHex){ve.splice(t,1),he[fe[o].commentHex]=!0;break}fe=fe.concat(ve),ge=xn(fe),xe=Object.assign({},xe,e.commenters),Se=e.configuredOauths;var i=Re(".commento-card");if(i)for(var t in i)removeClass(i[t],"highlight");pe=!1,Fe(r)})}function nn(e){if(""!==e){var n=sn(e);Ie(Re(g),n),setTimeout(function(){n.remove()},5e3)}}function tn(){We(Re(s),"style","display: none;")}function on(e){var n=Re(k+e),t=Re(re+e),o=Pe("table"),i=Pe("tr"),r=Pe("td"),a=Pe("td"),c=Pe("tr"),m=Pe("td"),d=Pe("td"),l=Pe("tr"),s=Pe("td"),u=Pe("td"),p=Pe("tr"),f=Pe("td"),v=Pe("td"),h=Pe("tr"),g=Pe("td"),x=Pe("td"),b=Pe("tr"),w=Pe("td"),y=Pe("td");o.id=ae+e,De(o,"markdown-help"),m.innerHTML="<b>bold</b>",d.innerHTML="surround text with <pre>**two asterisks**</pre>",r.innerHTML="<i>italics</i>",a.innerHTML="surround text with <pre>*asterisks*</pre>",s.innerHTML="<pre>code</pre>",u.innerHTML="surround text with <pre>`backticks`</pre>",f.innerHTML="<strike>strikethrough</strike>",v.innerHTML="surround text with <pre>~~two tilde characters~~</pre>",g.innerHTML='<a href="https://example.com">hyperlink</a>',x.innerHTML="<pre>[link](https://example.com)</pre> or just a bare URL",w.innerHTML="<blockquote>quote</blockquote>",y.innerHTML="prefix with <pre>&gt;</pre>",Ye(t=qe(t),rn,e),Ie(i,r),Ie(i,a),Ie(o,i),Ie(c,m),Ie(c,d),Ie(o,c),Ie(h,g),Ie(h,x),Ie(o,h),Ie(l,s),Ie(l,u),Ie(o,l),Ie(p,f),Ie(p,v),Ie(o,p),Ie(b,w),Ie(b,y),Ie(o,b),Ie(n,o)}function rn(e){var n=Re(re+e),t=Re(ae+e);Ye(n=qe(n),on,e),Ve(t)}function an(e){var n=Re(y+e);Re(w+e).checked?Ue(n,"make-invisible"):De(n,"make-invisible")}function cn(e,n){var t=Pe("div"),o=Pe("div"),i=Pe("textarea"),r=Pe("div"),a=Pe("input"),c=Pe("label"),m=Pe("button"),d=Pe("a"),l=Pe("div"),s=Pe("input"),u=Pe("br");return t.id=k+e,o.id=x+e,i.id=b+e,l.id=y+e,s.id=P+e,a.id=w+e,m.id=ie+e,d.id=re+e,De(o,"textarea-container"),De(r,"round-check"),De(r,"anonymous-checkbox-container"),De(m,"button"),De(m,"submit-button"),De(d,"markdown-button"),De(t,"button-margin"),De(s,"guest-details"),De(l,"guest-details-container"),De(l,"round-check"),De(u,"clear"),We(i,"placeholder","Add a comment"),We(a,"type","checkbox"),We(c,"for",w+e),We(s,"type","text"),We(s,"placeholder","Your Name (optional)"),c.innerText="Comment anonymously",m.innerText=!0===n?"Save Changes":"Add Comment",d.innerHTML="<b>M &#8595;</b> &nbsp; Markdown",Le?(a.checked=!0,a.setAttribute("disabled",!0)):De(l,"make-invisible"),Ye(a,an,e),i.oninput=function(e){return function(){e.style.height="",e.style.height=Math.min(Math.max(e.scrollHeight,75),400)+"px"}}(i),Ye(m,!0===n?gn:kn,e),Ye(d,on,e),Ie(o,i),Ie(t,o),Ie(t,l),Ie(r,a),Ie(r,c),Ie(t,m),be||!0===n||(Ie(t,r),Ie(l,s)),Ie(t,d),Ie(t,u),t}E.logout=function(){Xe("commentoCommenterToken","anonymous"),we=ue=!1,Be=void 0,Mn()};var mn={"score-desc":"Upvotes","creationdate-desc":"Newest","creationdate-asc":"Oldest"};function dn(e){Ue(Re(V+Ee),"sort-policy-button-selected");var n=Re(h);Ee=e;var t=vn(ge,"root");t&&wn(n,t),De(Re(V+e),"sort-policy-button-selected")}function ln(e){var n=Pe("div"),t=Pe("div"),o=Re(m),i=Pe("div"),r=Pe("div");n.id=d,i.id=g,r.id=h,Ie(o,i),De(n,"login"),De(t,"login-text"),De(r,"comments"),t.innerText="Login",r.innerHTML="",Ye(t,E.loginBoxShow,null);var a=0;Object.keys(Se).forEach(function(e){Se[e]&&a++}),0<a?Ie(n,t):be||(Le=!0),ue?Ve(Re(d)):Ie(o,n),Ie(o,ke?sn("This thread is locked. You cannot add new comments."):ye?sn("This domain is frozen. Comments have been disabled."):cn("root")),0<fe.length&&Ie(o,function(){var e=Pe("div"),n=Pe("div");for(var t in De(e,"sort-policy-buttons-container"),De(n,"sort-policy-buttons"),mn){var o=Pe("a");o.id=V+t,De(o,"sort-policy-button"),t===Ee&&De(o,"sort-policy-button-selected"),o.innerText=mn[t],Ye(o,dn,t),Ie(n,o)}return Ie(e,n),e}()),Ie(o,r),Ie(le,o),Fe(e)}function sn(e){var n=Pe("div");return De(n,"moderation-notice"),n.innerText=e,n}function un(e){for(var n=["#396ab1","#da7c30","#3e9651","#cc2529","#922428","#6b4c9a","#535154"],t=0,o=0;o<e.length;o++)t+=e.charCodeAt(o);return n[t%n.length]}function pn(e){return 1!==e?e+" points":e+" point"}E.commentNew=function(r,a,c){var m=Re(k+r),d=Re(b+r),l=Re(G+r),s=d.value;if(""!==s){Ue(d,"red-border");var e={commenterToken:a,anonName:Re(P+r).value,domain:parent.location.host,path:se,parentHex:r,markdown:s};_e(me+"/api/comment/new",e,function(e){if(e.success){tn();var n="";"unapproved"===e.state?n="Your comment is under moderation.":"flagged"===e.state&&(n="Your comment was flagged as spam and is under moderation."),""!==n&&nn(n);var t=Be;void 0!==t&&"anonymous"!==a||(t="anonymous"),"anonymous"===t&&0<Re(P+r).value.trim().length&&(xe[t=r]={provider:"anon",name:Re(P+r).value.trim(),photo:"undefined",link:""}),"anonymous"===t&&0<Re(P+r).value.trim().length&&(xe[t=r]={provider:"anon",name:Re(P+r).value.trim(),photo:"undefined"});var o={commentHex:e.commentHex,commenterHex:t,markdown:s,html:e.html,parentHex:r,score:0,state:"approved",direction:0,creationDate:new Date};"unapproved"===e.state&&(o.state="pending"),fe.push(o),ve.push(o),he[e.commentHex]=!0,ge=xn(fe),"root"!==r?(m.remove(),delete He[r],De(l,"option-reply"),Ue(l,"option-cancel"),l.title="Reply to this comment",Ye(l,E.replyShow,r)):d.value="",bn();var i=Re(j+e.commentHex).getBoundingClientRect().top+window.pageYOffset-40;window.scrollTo({top:i,behavior:"smooth"}),Fe(c)}else nn(e.message)})}else De(d,"red-border")};var fn={"score-desc":function(e,n){return n.score-e.score},"creationdate-desc":function(e,n){return e.creationDate<n.creationDate?1:-1},"creationdate-asc":function(e,n){return e.creationDate<n.creationDate?-1:1}};function vn(S,L){var e=S[L];if(!e||!e.length)return null;e.sort(function(e,n){return e.deleted||e.commentHex!==Te?n.deleted||n.commentHex!==Te?fn[Ee](e,n):1/0:-1/0});var A=(new Date).getTime(),M=Pe("div");return e.forEach(function(e){var n,t,o=xe[e.commenterHex],i=Pe("div"),r=Pe("div"),a=Pe("div"),c=Pe("div"),m=Pe("div"),d=Pe("div"),l=Pe("div"),s=Pe("div"),u=Pe("button"),p=Pe("button"),f=Pe("button"),v=Pe("button"),h=Pe("button"),g=Pe("button"),x=Pe("button"),b=Pe("button"),w=vn(S,e.commentHex),y=Pe("div"),k=Pe("a"),T=un(e.commenterHex+"-"+o.name);if("undefined"!==o.link&&"https://undefined"!==o.link&&""!==o.link?((t=Pe("a")).target="_blank",t.rel="nofollow noopener"):t=Pe("div"),i.id=j+e.commentHex,d.id=q+e.commentHex,l.id=Y+e.commentHex,a.id=z+e.commentHex,c.id=W+e.commentHex,m.id=_+e.commentHex,s.id=F+e.commentHex,u.id=X+e.commentHex,p.id=G+e.commentHex,f.id=J+e.commentHex,v.id=K+e.commentHex,h.id=$+e.commentHex,g.id=Q+e.commentHex,x.id=Z+e.commentHex,b.id=ee+e.commentHex,w&&(w.id=ne+e.commentHex),y.id=te+e.commentHex,t.id=oe+e.commentHex,k.href="#commento-"+e.commentHex,k.innerText="permalink",k.onclick=function(){window.location.hash="#commento-"+e.commentHex,An(),bn()},f.title="Collapse children",v.title="Upvote",h.title="Downvote",u.title="Edit",p.title="Reply",g.title="Approve",x.title="Remove",Te===e.commentHex?b.title=we?"Unsticky":"This comment has been stickied":b.title="Sticky",c.title=e.creationDate.toString(),i.style.borderLeft="2px solid "+T,e.deleted?t.innerText="[deleted]":t.innerText=o.name,l.innerHTML=e.html,c.innerHTML=function(e,n){var t=2592e6,o=e-n;return o<5e3?"just now":o<12e4?Math.round(o/1e3)+" seconds ago":o<72e5?Math.round(o/6e4)+" minutes ago":o<1728e5?Math.round(o/36e5)+" hours ago":o<5184e6?Math.round(o/864e5)+" days ago":o<62208e6?Math.round(o/t)+" months ago":Math.round(o/31104e6)+" years ago"}(A,e.creationDate),m.innerText=pn(e.score),"undefined"===o.photo?((n=Pe("div")).style.background=T,"anonymous"===e.commenterHex?(n.innerHTML="?",n.style["font-weight"]="bold"):n.innerHTML=o.name[0].toUpperCase(),De(n,"avatar")):(We(n=Pe("img"),"src",de+"/api/commenter/photo?commenterHex="+o.commenterHex),De(n,"avatar-img")),De(i,"card"),we&&"approved"!==e.state&&De(i,"dark-card"),"anon"===o.provider&&De(t,"anonymous"),o.isModerator&&De(t,"moderator"),"pending"===e.state&&De(t,"pending"),"flagged"===e.state&&De(t,"flagged"),he[e.commentHex]&&(De(i,"highlight"),delete he[e.commentHex]),De(r,"header"),De(t,"name"),De(k,"permalink"),De(a,"subtitle"),De(c,"timeago"),De(m,"score"),De(d,"body"),De(s,"options"),Oe&&De(s,"options-mobile"),De(u,"option-button"),De(u,"option-edit"),De(p,"option-button"),De(p,"option-reply"),De(f,"option-button"),De(f,"option-collapse"),De(v,"option-button"),De(v,"option-upvote"),De(h,"option-button"),De(h,"option-downvote"),De(g,"option-button"),De(g,"option-approve"),De(x,"option-button"),De(x,"option-remove"),De(b,"option-button"),Te===e.commentHex?De(b,"option-unsticky"):De(b,"option-sticky"),ue&&(0<e.direction?De(v,"upvoted"):e.direction<0&&De(h,"downvoted")),Ye(u,E.editShow,e.commentHex),Ye(f,E.commentCollapse,e.commentHex),Ye(g,E.commentApprove,e.commentHex),Ye(x,E.commentDelete,e.commentHex),Ye(b,E.commentSticky,e.commentHex),ue){var H=hn(v,h,e.commentHex,e.direction);v=H[0],h=H[1]}else Ye(v,E.loginBoxShow,null),Ye(h,E.loginBoxShow,null);Ye(p,E.replyShow,e.commentHex),"undefined"!==o.link&&"https://undefined"!==o.link&&""!==o.link&&We(t,"href",o.link),w&&Ie(s,f),e.deleted||ye||ke||(Ie(s,h),Ie(s,v)),e.commenterHex===Be?Ie(s,u):e.deleted||ye||ke||Ie(s,p),!e.deleted&&we&&"root"===L&&Ie(s,b),e.deleted||!we&&e.commenterHex!==Be||Ie(s,x),we&&"approved"!==e.state&&Ie(s,g),e.deleted||we||Te!==e.commentHex||Ie(s,b),We(s,"style","width: "+32*(s.childNodes.length+1)+"px;");for(var C=0;C<s.childNodes.length;C++)We(s.childNodes[C],"style","right: "+32*C+"px;");if(Ie(a,m),Ie(a,c),Oe||Ie(r,s),Ie(r,n),Ie(r,t),Ie(r,a),Ie(d,l),Ie(d,k),Ie(y,d),Oe){Ie(y,s);var N=Pe("div");De(N,"options-clearfix"),Ie(y,N)}w&&(De(w,"body"),Ie(y,w)),Ie(i,r),Ie(i,y),e.deleted&&("true"===B||null===w)||Ie(M,i)}),0===M.childNodes.length?null:M}function hn(e,n,t,o){return e=qe(e),n=qe(n),0<o?(Ye(e,E.vote,[t,[1,0]]),Ye(n,E.vote,[t,[1,-1]])):o<0?(Ye(e,E.vote,[t,[-1,1]]),Ye(n,E.vote,[t,[-1,0]])):(Ye(e,E.vote,[t,[0,1]]),Ye(n,E.vote,[t,[0,-1]])),[e,n]}function gn(i){var e=Re(b+i),r=e.value;if(""!==r){Ue(e,"red-border");var n={commenterToken:Ge(),commentHex:i,markdown:r};_e(me+"/api/comment/edit",n,function(e){if(e.success){tn(),xn(fe),ge[i].markdown=r,ge[i].html=e.html;var n=Re(X+i),t=Re(k+i);t.innerHTML=ge[i].html,t.id=Y+i,delete Ce[i],he[i]=!0,De(n,"option-edit"),Ue(n,"option-cancel"),n.title="Edit comment",Ye(n=qe(n),E.editShow,i);var o="";"unapproved"===e.state?o="Your comment is under moderation.":"flagged"===e.state&&(o="Your comment was flagged as spam and is under moderation."),nn(sn(o))}else nn(e.message)})}else De(e,"red-border")}function xn(e){var o={};return e.forEach(function(e,n){var t=e.parentHex;t in o||(o[t]=[]),e.creationDate=new Date(e.creationDate),o[t].push(e),ge[e.commentHex]={html:e.html,markdown:e.markdown,index:n}}),o}function bn(){var e=Re(h),n=vn(ge,"root");n&&wn(e,n)}function wn(e,n){for(var t in 0===e.children.length&&(e.innerHTML="<div></div>"),morphdom(e.children[0],n,{onBeforeNodeDiscarded:function(e){return!(-1<e.innerHTML.indexOf("textarea"))},onBeforeNodeAdded:function(e){return!(e.id.split("-")[3]in Ce)&&e}}),Ne)E.commentCollapse(t);for(var t in He)He[t]=!1,E.replyShow(t,!0);for(var t in Ce)Ce[t]=!1,E.editShow(t,!0)}function yn(e){ue?E.commentNew(e,Ge()):E.loginBoxShow(e)}function kn(e){if(be)yn(e);else{var n=Re(w+e),t=Re(b+e);if(""!==t.value)return Ue(t,"red-border"),n.checked?void function(e){E.commentNew(e,"anonymous")}(e):void yn(e);De(t,"red-border")}}function Tn(e,n,t){_e(me+"/api/commenter/login",{email:e,password:n},function(e){if(!e.success)return E.loginBoxClose(),void nn(e.message);tn(),Xe("commentoCommenterToken",e.commenterToken),$e(e.commenter,e.email),Sn(),Ve(Re(d)),null!==t?E.commentNew(t,e.commenterToken,function(){E.loginBoxClose(),en(bn)}):(E.loginBoxClose(),en(bn))})}function Hn(n){var e={isLocked:ke,stickyCommentHex:Te},t={commenterToken:Ge(),domain:parent.location.host,path:se,attributes:e};_e(me+"/api/page/update",t,function(e){e.success?(tn(),Fe(n)):nn(e.message)})}function Cn(){var e=Pe("div"),n=Pe("button");e.id=l,n.id=t,De(e,"mod-tools"),n.innerHTML=ke?"Unlock Thread":"Lock Thread",Ye(n,E.threadLockToggle),We(e,"style","display: none"),Ie(e,n),Ie(le,e)}function Nn(){void 0===o?Sn():Ze(o,Sn)}function Sn(){var e=Re(m),n=Re(l),t=Re(v);We(e,"style",""),we&&We(n,"style",""),t&&We(t,"style","")}function Ln(){for(var e=function(e){return r.getElementsByTagName(e)}("script"),n=0;n<e.length;n++)if(e[n].src.match(/\/js\/commento\.js$/)){var t=je(e[n],"data-page-id");void 0!==t&&(se=t),o=je(e[n],"data-css-override"),a=je(e[n],"data-auto-init"),void 0===(c=je(e[n],"data-id-root"))&&(c="commento"),i=je(e[n],"data-no-fonts"),B=je(e[n],"data-hide-deleted")}}function An(){if(window.location.hash)if(window.location.hash.startsWith("#commento-")){var e="";e=window.location.hash.startsWith("#commento-comment-card")?window.location.hash.split("-")[3]:window.location.hash.split("-")[1];var n=Re(j+e);if(null===n)return;De(n,"highlight"),n.scrollIntoView({behavior:"smooth"})}else window.location.hash.startsWith("#commento")&&le.scrollIntoView({behavior:"smooth"})}function Mn(e){le.innerHTML="",He={},Ce={},E.main(e)}E.commentApprove=function(i){var e={commenterToken:Ge(),commentHex:i};_e(me+"/api/comment/approve",e,function(e){if(e.success){tn();var n=Re(j+i),t=Re(oe+i),o=Re(Q+i);Ue(n,"dark-card"),Ue(t,"flagged"),Ve(o)}else nn(e.message)})},E.commentDelete=function(t){if(confirm("Are you sure you want to delete this comment?")){var e={commenterToken:Ge(),commentHex:t};_e(me+"/api/comment/delete",e,function(e){if(e.success){tn(),Re(Y+t).innerText="[deleted]";var n=Re(j+t);n.parentNode.removeChild(n),delete ge[t]}else nn(e.message)})}},E.vote=function(e){var n=e[0],t=e[1][0],o=e[1][1],i=Re(K+n),r=Re($+n),a=Re(_+n),c={commenterToken:Ge(),commentHex:n,direction:o},m=hn(i,r,n,o);for(var d in i=m[0],r=m[1],Ue(i,"upvoted"),Ue(r,"downvoted"),0<o?De(i,"upvoted"):o<0&&De(r,"downvoted"),a.innerText=pn(parseInt(a.innerText.replace(/[^\d-.]/g,""))+o-t),fe)fe[d].commentHex===n&&(fe[d].score=fe[d].score+o-t);ge=xn(fe),bn(),_e(me+"/api/comment/vote",c,function(e){if(!e.success)return nn(e.message),Ue(i,"upvoted"),Ue(r,"downvoted"),a.innerText=pn(parseInt(a.innerText.replace(/[^\d-.]/g,""))-o+t),void hn(i,r,n,t);tn()})},E.editShow=function(e,n){if(!(e in Ce&&Ce[e])){var t=Re(Y+e);if(Ce[e]=!0,!n){t.replaceWith(cn(e,!0));var o=Re(b+e);xn(fe),o.value=ge[e].markdown}var i=Re(X+e);Ue(i,"option-edit"),De(i,"option-cancel"),i.title="Cancel edit",Ye(i=qe(i),E.editCollapse,e)}},E.editCollapse=function(e){var n=Re(X+e),t=Re(k+e);t.innerHTML=ge[e].html,t.id=Y+e,delete Ce[e],De(n,"option-edit"),Ue(n,"option-cancel"),n.title="Edit comment",Ye(n=qe(n),E.editShow,e)},E.replyShow=function(e,n){if(!(e in He&&He[e])){var t=Re(Y+e);n||function(e,n){e.parentNode.insertBefore(n,e.nextSibling)}(t,cn(e)),He[e]=!0;var o=Re(G+e);Ue(o,"option-reply"),De(o,"option-cancel"),o.title="Cancel reply",Ye(o=qe(o),E.replyCollapse,e)}},E.replyCollapse=function(e){var n=Re(G+e),t=Re(k+e);t?(t.remove(),delete He[e],De(n,"option-reply"),Ue(n,"option-cancel"),n.title="Reply to this comment",Ye(n=qe(n),E.replyShow,e)):E.replyShow(e)},E.commentCollapse=function(e){var n=Re(ne+e),t=Re(J+e);Ne[e]=!0,n&&De(n,"hidden"),Ue(t,"option-collapse"),De(t,"option-uncollapse"),t.title="Expand children",Ye(t=qe(t),E.commentUncollapse,e)},E.commentUncollapse=function(e){var n=Re(ne+e),t=Re(J+e);delete Ne[e],n&&Ue(n,"hidden"),Ue(t,"option-uncollapse"),De(t,"option-collapse"),t.title="Collapse children",Ye(t=qe(t),E.commentCollapse,e)},E.commentoAuth=function(e){var t=e.provider,o=e.id,i=window.open("","_blank");!function(e,n){var t=new XMLHttpRequest;t.open("GET",e,!0),t.onload=function(){n(JSON.parse(t.response))},t.send(null)}(me+"/api/commenter/token/new",function(n){if(n.success){tn(),Xe("commentoCommenterToken",n.commenterToken),i.location=me+"/api/oauth/"+t+"/redirect?commenterToken="+n.commenterToken;var e=setInterval(function(){i.closed&&(clearInterval(e),Qe(function(){var e=Re(v);e&&We(e,"style",""),"anonymous"!==Ge()&&Ve(Re(d)),null!==o?E.commentNew(o,n.commenterToken,function(){E.loginBoxClose(),en(bn)}):(E.loginBoxClose(),en(bn))}))},250)}else nn(n.message)})},E.nextInput=function(o,i){return function(e){var n=Array.prototype.slice.call(r.querySelectorAll(".commento-input")),t=n.indexOf(o);t>=n.length-1?i(e):(console.log(n[t+1]),n[t+1].focus())}},E.popupRender=function(t){var e=Re(T),n=Pe("div"),o=Pe("div"),i=Pe("div"),r=Pe("div"),a=Pe("hr"),c=Pe("div"),m=Pe("div"),d=Pe("div"),l=Pe("hr"),s=Pe("div"),u=Pe("div"),p=Pe("div"),f=Pe("input"),v=Pe("button"),h=Pe("div"),g=Pe("a"),x=Pe("div"),b=Pe("a"),w=Pe("div");n.id=H,s.id=C,f.id=N,v.id=S,h.id=L,x.id=A,i.id=O,o.id=M,a.id=R,c.id=I,m.id=D,l.id=U,De(e,"login-box-container"),De(n,"login-box"),De(s,"login-box-subtitle"),De(u,"email-container"),De(p,"email"),De(f,"input"),De(v,"email-button"),De(h,"forgot-link-container"),De(g,"forgot-link"),De(x,"login-link-container"),De(b,"login-link"),De(o,"login-box-subtitle"),De(i,"oauth-buttons-container"),De(r,"oauth-buttons"),De(c,"login-box-subtitle"),De(m,"oauth-buttons-container"),De(d,"oauth-buttons"),De(w,"login-box-close"),De(le,"root-min-height"),g.innerText="Forgot your password?",b.innerText="Don't have an account? Sign up.",s.innerText="Login with your email address",v.innerText="Continue",c.innerText="Proceed with social login",o.innerText="Proceed with "+parent.location.host+" authentication",Ye(v,E.passwordAsk,t),ze(f,E.nextInput(f,E.passwordAsk),t),Ye(g,E.forgotPassword,t),Ye(b,E.popupSwitch,t),Ye(w,E.loginBoxClose),We(e,"style","display: none; opacity: 0;"),We(f,"name","email"),We(f,"placeholder","Email address"),We(f,"type","text");var y=0;if(["google","twitter","github","gitlab"].forEach(function(e){if(Se[e]){var n=Pe("button");De(n,"button"),De(n,e+"-button"),n.innerText=e,Ye(n,E.commentoAuth,{provider:e,id:t}),Ie(d,n),y++}}),Se.sso){var k=Pe("button");De(k,"button"),De(k,"sso-button"),k.innerText="Single Sign-On",Ye(k,E.commentoAuth,{provider:"sso",id:t}),Ie(r,k),Ie(i,r),Ie(n,o),Ie(n,i),(0<y||Se.commento)&&Ie(n,a)}Me=0<y&&(Ie(n,c),Ie(m,d),Ie(n,m),!0),Ie(p,f),Ie(p,v),Ie(u,p),Ie(h,g),Ie(x,b),0<y&&Se.commento&&Ie(n,l),Se.commento&&(Ie(n,s),Ie(n,u),Ie(n,h),Ie(n,x)),Ie(n,w),Ae="login",e.innerHTML="",Ie(e,n)},E.forgotPassword=function(){window.open("","_blank").location=me+"/forgot?commenter=true",E.loginBoxClose()},E.popupSwitch=function(e){var n=Re(C);Me&&(Ve(Re(D)),Ve(Re(I)),Ve(Re(R)),Ve(Re(U))),Se.sso&&(Ve(Re(O)),Ve(Re(M)),Ve(Re(R)),Ve(Re(U))),Ve(Re(A)),Ve(Re(L)),n.innerText="Create an account",Ae="signup",E.passwordAsk(e)},E.login=function(e){var n=Re(N),t=Re(u);Tn(n.value,t.value,e)},E.signup=function(n){var t=Re(N),e=Re(p),o=Re(f),i=Re(u),r={email:t.value,name:e.value,website:o.value,password:i.value};_e(me+"/api/commenter/new",r,function(e){if(!e.success)return E.loginBoxClose(),void nn(e.message);tn(),Tn(t.value,i.value,n)})},E.passwordAsk=function(e){var n,t,o,i,r=Re(H),a=Re(C);Ve(Re(S)),Ve(Re(A)),Ve(Re(L)),Me&&0<Se.length&&(Ve(Re(R)),Ve(Re(U)),Ve(Re(I)),Ve(Re(D))),i="signup"===Ae?(n=["name","website","password"],t=[p,f,u],o=["text","text","password"],["Real Name","Website (Optional)","Password"]):(n=["password"],t=[u],o=["password"],["Password"]),a.innerText="signup"===Ae?"Finish the rest of your profile to complete.":"Enter your password to log in.";for(var c=0;c<n.length;c++){var m=Pe("div"),d=Pe("div"),l=Pe("input");if(l.id=t[c],De(m,"email-container"),De(d,"email"),De(l,"input"),We(l,"name",n[c]),We(l,"type",o[c]),We(l,"placeholder",i[c]),"website"===n[c]&&We(l,"autocomplete","false"),Ie(d,l),Ie(m,d),"password"===n[c]){var s=Pe("button");De(s,"email-button"),"signup"===(s.innerText=Ae)?(Ye(s,E.signup,e),ze(l,E.signup,e)):(Ye(s,E.login,e),ze(l,E.login,e)),Ie(d,s)}else ze(l,E.nextInput(l,null),e);Ie(r,m)}},E.threadLockToggle=function(){var e=Re(t);ke=!ke,e.disabled=!0,Hn(function(){e.disabled=!1,Mn(bn)})},E.commentSticky=function(n){if("none"!==Te){var e=Re(ee+Te);Ue(e,"option-unsticky"),De(e,"option-sticky")}Te=Te===n?"none":n,Hn(function(){var e=Re(ee+n);Te===n?(Ue(e,"option-sticky"),De(e,"option-unsticky")):(Ue(e,"option-unsticky"),De(e,"option-sticky"))})},E.loginBoxClose=function(){var e=Re(m),n=Re(T);Ue(e,"blurred"),Ue(le,"root-min-height"),We(n,"style","display: none")},E.loginBoxShow=function(e){var n=Re(m),t=Re(T);E.popupRender(e),De(n,"blurred"),We(t,"style",""),Re(T).scrollIntoView({behavior:"smooth"})},E.main=function(e){if(null!==(le=Re(c))){null===Oe&&(Oe=le.getBoundingClientRect().width<450),De(le,"root"),"true"!==i&&De(le,"root-font"),function(){var e=Pe("div");e.id=T,Ie(le,e)}(),function(){var e=Pe("div");e.id=s,De(e,"error-box"),We(e,"style","display: none;"),Ie(le,e)}(),function(){var e=Pe("div");e.id=m,De(e,"main-area"),We(e,"style","display: none"),Ie(le,e)}(),Cn();var n=function(){var e=Pe("div"),n=Pe("div"),t=Pe("a"),o=Pe("span");return e.id="commento-footer",De(e,"footer"),De(n,"logo-container"),De(t,"logo"),De(o,"logo-text"),We(t,"href","https://commento.io"),We(t,"target","_blank"),o.innerText="Commento",Ie(t,o),Ie(n,t),Ie(e,n),e}();Ze(de+"/css/commento.css",Nn),Qe(function(){en(function(){Cn(),ln(function(){bn(),Ie(le,n),An(),Sn(),function(){for(var e=r.getElementsByClassName("commento-name"),n=0;n<e.length;n++)We(e[n],"style","max-width: "+(e[n].getBoundingClientRect().width+20)+"px;")}(),Fe(e)})})})}else console.log("[commento] error: no root element with ID '"+c+"' found")};var En=-1;function Bn(){var n=me.split(":");n[0]="https:"===location.protocol?"wss":"ws",n=n.join(":");var t=new WebSocket(n+"/ws");t.onopen=function(){t.send(parent.location.host+se),clearInterval(En)},t.onmessage=function(){window.document.title="(*) "+ce,en(bn,!0)},t.onclose=function(){console.log("Socket is closed. Reconnect will be attempted with an exponential backoff.",e.reason),En=setInterval(Bn,1e3)},t.onerror=function(e){console.error("Socket encountered error: ",e.message,"Closing socket"),t.close()}}function On(){n||(window.WebSocket?(Bn(),window.setInterval(function(){bn()},6e4)):window.setInterval(function(){en(bn,!0)},5e3),function(){function n(){window.document.title=ce}["mousedown","mousemove","keydown","scroll","touchstart"].forEach(function(e){r.addEventListener(e,n,!0)})}(),n=!0,Ln(),"true"===a||void 0===a?E.main(void 0):"false"!==a&&console.log("[commento] error: invalid value for data-auto-init; allowed values: true, false"))}var Rn=function(){var e=r.readyState;"loading"===e?r.addEventListener("readystatechange",Rn):"interactive"===e?On():"complete"===e&&On()};Rn()}(window.commento,document),function(){"use strict";var n;var C="http://www.w3.org/1999/xhtml",N="undefined"==typeof document?void 0:document,t=!!N&&"content"in N.createElement("template"),o=!!N&&N.createRange&&"createContextualFragment"in N.createRange();function S(e){return e=e.trim(),t?function(e){var n=N.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}(e):o?function(e){return n||(n=N.createRange()).selectNode(N.body),n.createContextualFragment(e).childNodes[0]}(e):function(e){var n=N.createElement("body");return n.innerHTML=e,n.childNodes[0]}(e)}function L(e,n){var t,o,i=e.nodeName,r=n.nodeName;return i===r||(t=i.charCodeAt(0),o=r.charCodeAt(0),t<=90&&97<=o?i===r.toUpperCase():o<=90&&97<=t&&r===i.toUpperCase())}function i(e,n,t){e[t]!==n[t]&&(e[t]=n[t],e[t]?e.setAttribute(t,""):e.removeAttribute(t))}var A,M={OPTION:function(e,n){var t=e.parentNode;if(t){var o=t.nodeName.toUpperCase();"OPTGROUP"===o&&(o=(t=t.parentNode)&&t.nodeName.toUpperCase()),"SELECT"!==o||t.hasAttribute("multiple")||(e.hasAttribute("selected")&&!n.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),t.selectedIndex=-1)}i(e,n,"selected")},INPUT:function(e,n){i(e,n,"checked"),i(e,n,"disabled"),e.value!==n.value&&(e.value=n.value),n.hasAttribute("value")||e.removeAttribute("value")},tEXTAREA:function(e,n){var t=n.value;e.value!==t&&(e.value=t);var o=e.firstChild;if(o){var i=o.nodeValue;if(i===t||!t&&i===e.placeholder)return;o.nodeValue=t}},SELECT:function(e,n){if(!n.hasAttribute("multiple")){for(var t,o,i=-1,r=0,a=e.firstChild;a;)if("OPTGROUP"===(o=a.nodeName&&a.nodeName.toUpperCase()))a=(t=a).firstChild;else{if("OPTION"===o){if(a.hasAttribute("selected")){i=r;break}r++}!(a=a.nextSibling)&&t&&(a=t.nextSibling,t=null)}e.selectedIndex=i}}};function E(){}function B(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}window.morphdom=(A=function(e,n){var t,o,i,r,a=n.attributes;if(11!==n.nodeType&&11!==e.nodeType){for(var c=a.length-1;0<=c;c--)o=(t=a[c]).name,i=t.namespaceURI,r=t.value,i?(o=t.localName||o,e.getAttributeNS(i,o)!==r&&("xmlns"===t.prefix&&(o=t.name),e.setAttributeNS(i,o,r))):e.getAttribute(o)!==r&&e.setAttribute(o,r);for(var m=e.attributes,d=m.length-1;0<=d;d--)o=(t=m[d]).name,(i=t.namespaceURI)?(o=t.localName||o,n.hasAttributeNS(i,o)||e.removeAttributeNS(i,o)):n.hasAttribute(o)||e.removeAttribute(o)}},function(e,n,t){if(t=t||{},"string"==typeof n)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var o=n;(n=N.createElement("html")).innerHTML=o}else n=S(n);var p=t.getNodeKey||B,f=t.onBeforeNodeAdded||E,r=t.onNodeAdded||E,i=t.onBeforeElUpdated||E,a=t.onElUpdated||E,c=t.onBeforeNodeDiscarded||E,m=t.onNodeDiscarded||E,d=t.onBeforeElChildrenUpdated||E,l=!0===t.childrenOnly,v=Object.create(null),s=[];function h(e){s.push(e)}function g(e,n,t){!1!==c(e)&&(n&&n.removeChild(e),m(e),function e(n,t){if(1===n.nodeType)for(var o=n.firstChild;o;){var i=void 0;t&&(i=p(o))?h(i):(m(o),o.firstChild&&e(o,t)),o=o.nextSibling}}(e,t))}function x(e){r(e);for(var n=e.firstChild;n;){var t=n.nextSibling,o=p(n);if(o){var i=v[o];i&&L(n,i)?(n.parentNode.replaceChild(i,n),b(i,n)):x(n)}else x(n);n=t}}function b(e,n,t){var o=p(n);if(o&&delete v[o],!t){if(!1===i(e,n))return;if(A(e,n),a(e),!1===d(e,n))return}"TEXTAREA"!==e.nodeName?function(e,n){var t,o,i,r,a,c=n.firstChild,m=e.firstChild;e:for(;c;){for(r=c.nextSibling,t=p(c);m;){if(i=m.nextSibling,c.isSameNode&&c.isSameNode(m)){c=r,m=i;continue e}o=p(m);var d=m.nodeType,l=void 0;if(d===c.nodeType&&(1===d?(t?t!==o&&((a=v[t])?i===a?l=!1:(e.insertBefore(a,m),o?h(o):g(m,e,!0),m=a):l=!1):o&&(l=!1),(l=!1!==l&&L(m,c))&&b(m,c)):3!==d&&8!==d||(l=!0,m.nodeValue!==c.nodeValue&&(m.nodeValue=c.nodeValue))),l){c=r,m=i;continue e}o?h(o):g(m,e,!0),m=i}if(t&&(a=v[t])&&L(a,c))e.appendChild(a),b(a,c);else{var s=f(c);!1!==s&&(s&&(c=s),c.actualize&&(c=c.actualize(e.ownerDocument||N)),e.appendChild(c),x(c))}c=r,m=i}!function(e,n,t){for(;n;){var o=n.nextSibling;(t=p(n))?h(t):g(n,e,!0),n=o}}(e,m,o);var u=M[e.nodeName];u&&u(e,n)}(e,n):M.tEXTAREA(e,n)}!function e(n){if(1===n.nodeType||11===n.nodeType)for(var t=n.firstChild;t;){var o=p(t);o&&(v[o]=t),e(t),t=t.nextSibling}}(e);var u=e,w=u.nodeType,y=n.nodeType;if(!l)if(1===w)1===y?L(e,n)||(m(e),u=function(e,n){for(var t=e.firstChild;t;){var o=t.nextSibling;n.appendChild(t),t=o}return n}(e,function(e,n){return n&&n!==C?N.createElementNS(n,e):N.createElement(e)}(n.nodeName,n.namespaceURI))):u=n;else if(3===w||8===w){if(y===w)return u.nodeValue!==n.nodeValue&&(u.nodeValue=n.nodeValue),u;u=n}if(u===n)m(e);else{if(n.isSameNode&&n.isSameNode(u))return;if(b(u,n,l),s)for(var k=0,T=s.length;k<T;k++){var H=v[s[k]];H&&g(H,H.parentNode,!1)}}return!l&&u!==e&&e.parentNode&&(u.actualize&&(u=u.actualize(e.ownerDocument||N)),e.parentNode.replaceChild(u,e)),u})}();
